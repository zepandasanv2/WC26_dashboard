name: Notify Discord on GitHub Events
on: [push, issues, pull_request]

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Set notification variables
        id: set_vars
        run: |
          if [ "${{ github.event_name }}" = "push" ]; then
            echo "title= Nouveau push sur le dépôt !" >> $GITHUB_OUTPUT
            echo "description=**Auteur** : ${{ github.actor }}\n**Branche** : \`${{ github.ref_name }}\`\n**Message** : ${{ github.event.head_commit.message }}\n**Lien** : [Voir le commit](${{ github.event.head_commit.url }})" >> $GITHUB_OUTPUT
            echo "color=5763719" >> $GITHUB_OUTPUT
          elif [ "${{ github.event_name }}" = "issues" ]; then
            if [ "${{ github.event.action }}" = "opened" ]; then
              echo "title= Nouvelle issue" >> $GITHUB_OUTPUT
              echo "color=15158332" >> $GITHUB_OUTPUT
            else
              echo "title= Issue fermée" >> $GITHUB_OUTPUT
              echo "color=3066992" >> $GITHUB_OUTPUT
            fi
            echo "description=**Titre** : ${{ github.event.issue.title }}\n**Auteur** : ${{ github.event.issue.user.login }}\n**Lien** : [Voir l'issue](${{ github.event.issue.html_url }})" >> $GITHUB_OUTPUT
          elif [ "${{ github.event_name }}" = "pull_request" ]; then
            if [ "${{ github.event.action }}" = "opened" ]; then
              echo "title= Nouvelle Pull Request" >> $GITHUB_OUTPUT
              echo "color=15844367" >> $GITHUB_OUTPUT
            elif [ "${{ github.event.pull_request.merged }}" = "true" ]; then
              echo "title= PR mergée" >> $GITHUB_OUTPUT
              echo "color=65280" >> $GITHUB_OUTPUT
            else
              echo "title= PR fermée" >> $GITHUB_OUTPUT
              echo "color=15105570" >> $GITHUB_OUTPUT
            fi
            echo "description=**Titre** : ${{ github.event.pull_request.title }}\n**Auteur** : ${{ github.event.pull_request.user.login }}\n**Lien** : [Voir la PR](${{ github.event.pull_request.html_url }})" >> $GITHUB_OUTPUT
          fi

      - name: Send Discord notification
        uses: Ilshidur/action-discord@master
        env:
          DISCORD_WEBHOOK: ${{ secrets.DISCORD_WEBHOOK_URL }}
        with:
          args: >
            {
              "embeds": [
                {
                  "title": "${{ steps.set_vars.outputs.title }}",
                  "description": "${{ steps.set_vars.outputs.description }}",
                  "color": ${{ steps.set_vars.outputs.color }},
                  "footer": {
                    "text": "Dépôt : ${{ github.event.repository.name }}"
                  }
                }
              ]
            }
